{% extends 'base.html' %}
{% load static %}

{% block title %}Lista postów{% endblock %}

{% block stylesheets %}

<link rel="stylesheet" href="{% static 'posts/css/posts_list.css' %}"> {% endblock %}
{% block content %}

<div class="main-container">
    <div class="posts-list"> {% if messages %} {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
    {% endif %}
    <h1>Ostatnie posty</h1>

{% for post in object_list %}
  <div class="post-card">
    <div class="post-header">
      <div class="user-section">
        <img src="{{ post.user.profile.image.url }}" class="user-avatar" alt="avatar">
        <div>
          <h5>{{ post.user.username }}</h5>
          <p class="post-date">{{ post.created_datetime }}</p>
        </div>
      </div>

      {% if post.user == user %}
        <div class="post-actions">
          <a href="{% url 'posts:edit' post.id %}" title="Edytuj"><i class="bi bi-pencil-square"></i></a>
          <a href="{% url 'posts:delete' post.id %}" title="Usuń"><i class="bi bi-x-square"></i></a>
        </div>
      {% endif %}
    </div>

    <div class="post-body">
      <a href="{% url 'posts:detail' post.id %}">
        <h4>{{ post.title }}</h4>
        <p>{{ post.contents|safe }}</p>
      </a>
    </div>

    <div class="post-footer">
      <form action="{% url 'posts:like' post.id %}" method="POST">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm {% if user in post.likes.all %}btn-secondary{% else %}btn-outline-primary{% endif %}">
          <i class="bi bi-hand-thumbs-up"></i> Like
        </button>
        <span class="likes-count">({{ post.number_of_likes }})</span>
      </form>
      <a class="btn btn-sm btn-outline-info" href="{% url 'posts:add_comment' post.id %}">
        <i class="bi bi-chat-left-text"></i> Skomentuj
      </a>
    </div>
  </div>
{% endfor %}

<div class="pagination-container">
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
      </li>
    {% endif %}
    <li class="page-item active"><a class="page-link" href="?page={{ page_obj.number }}">{{ page_obj.number }}</a></li>
    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
      </li>
    {% endif %}
  </ul>
</div>
</div>
    <aside class="sidebar">
        <h3>Sidebar</h3>
        <p>Tutaj możesz umieścić np. popularne tagi, ranking użytkowników albo linki do kategorii.</p>
    </aside>
</div>
{% endblock %}